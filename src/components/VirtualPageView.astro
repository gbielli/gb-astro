---
---

<script>
  // Fonction qui nettoie le dataLayer en le réinitialisant complètement
  function clearDataLayer() {
    // Réinitialise le dataLayer en le vidant complètement
    window.dataLayer = [];
    
  }

  // Fonction principale qui envoie la page vue virtuelle
  function sendVirtualPageview() {
    // Nettoie d'abord le dataLayer des anciennes données
    clearDataLayer();

    // Réinitialise ou crée le dataLayer si nécessaire
    window.dataLayer = window.dataLayer || [];

    // Envoie l'événement de page vue avec toutes les informations nécessaires
    window.dataLayer.push({
      event: 'page_view',
      page: {
        path: window.location.pathname,
        title: document.title,
        location: window.location.href
      }
    });
  }

  // Écoute les changements de page dans Astro et déclenche le suivi
  document.addEventListener('astro:page-load', () => {
    sendVirtualPageview();
  });
</script>